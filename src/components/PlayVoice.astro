---
interface Props {
  id: string;
}

const { id } = Astro.props;
---

{
  id && (
    <button
      id="play-voice"
      class="div absolute right-3 top-3 z-20"
      aria-label="play text content"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <polygon points="5 3 19 12 5 21 5 3" />
      </svg>
    </button>
  )
}

<script>
  const playIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><polygon points="5 3 19 12 5 21 5 3"/></svg>`;
  const pauseIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><rect width="4" height="16" x="6" y="4"/><rect width="4" height="16" x="14" y="4"/></svg>`;

  const audio = new Audio();
  audio.volume = 0.5;
  audio.src = "/voice/index.mp3";

  function initVoice() {
    const button = document.querySelector("button#play-voice");

    if (button) {
      button.addEventListener("click", () => {
        if (audio.paused) {
          audio.play();
        } else {
          audio.pause();
        }
      });

      audio.addEventListener("play", () => (button.innerHTML = pauseIcon));
      audio.addEventListener("pause", () => (button.innerHTML = playIcon));
    }
  }

  initVoice();

  document.addEventListener("astro:after-swap", () => initVoice());
</script>
